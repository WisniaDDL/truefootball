<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>Symulator Pi≈Çki - Liga</title>
  <style>
    /* (tutaj ca≈Çy Tw√≥j styl bez zmian) */
    /* ... */
  </style>
</head>
<body>
  <h1>Symulator Pi≈Çki - Liga</h1>
  <a href="index.html" class="link-button">üè† Powr√≥t do Strony G≈Ç√≥wnej</a>

  <div id="saveNotice" style="display:none; text-align:center; margin-bottom:15px; background:#d0f0c0; padding:10px; border-radius:8px; box-shadow:0 0 10px #81c784;">
    Zapisana kariera: <span id="saveInfo"></span><br/>
    <button onclick="loadCareer()">Wczytaj karierƒô</button>
    <button onclick="resetCareer()" style="margin-left: 10px; background:#e57373;">Usu≈Ñ zapis i zacznij nowƒÖ</button>
  </div>

  <div id="start">
    <label for="teamSelect">Wybierz swojƒÖ dru≈ºynƒô:</label>
    <select id="teamSelect" aria-label="Wybierz dru≈ºynƒô">
      <option value="FC Testowa">FC Testowa</option>
      <option value="GKS Demo">GKS Demo</option>
      <option value="FC Turbo">FC Turbo</option>
      <option value="LKS Wie≈õniaki">LKS Wie≈õniaki</option>
    </select>
    <button id="startBtn" onclick="startLeague()">Rozpocznij Ligƒô</button>
  </div>

  <div id="matchContainer" style="display:none;">
    <h2>Nastƒôpny mecz</h2>
    <p id="nextMatch" aria-live="polite"></p>
    <div style="text-align:center;">
      <button id="playMatchBtn" onclick="playNextMatch()">Zagraj mecz</button>
    </div>

    <div id="progressBarContainer" aria-label="Postƒôp sezonu">
      <div id="progressBar"></div>
    </div>

    <h2>Historia</h2>
    <ul id="matchHistory" aria-live="polite" aria-atomic="false"></ul>

    <h2>Tablica ligowa</h2>
    <table id="leagueTable" aria-describedby="leagueDescription">
      <caption id="leagueDescription" style="text-align:left; font-style:italic; margin-bottom:6px;">
        Statystyki dru≈ºyn w lidze - mecze (M), wygrane (W), remisy (R), pora≈ºki (P), bramki (Br), r√≥≈ºnica bramek (+/-), punkty (Pkt)
      </caption>
      <thead>
        <tr><th>Dru≈ºyna</th><th>M</th><th>W</th><th>R</th><th>P</th><th>Br</th><th>+/-</th><th>Pkt</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    const teams = ["FC Testowa", "GKS Demo", "FC Turbo", "LKS Wie≈õniaki"];
    let userTeam = "";
    let fixtures = [];
    let currentMatch = 0;
    let table = {};
    let careerStartDate = null;

    const saveKey = "footballCareerSave";

    // Sprawd≈∫ czy jest zapis kariery przy starcie
    window.onload = () => {
      const savedCareer = localStorage.getItem(saveKey);
      if (savedCareer) {
        const data = JSON.parse(savedCareer);
        document.getElementById("saveInfo").textContent = `Dru≈ºyna: ${data.userTeam}, rozpoczƒôta: ${new Date(data.careerStartDate).toLocaleString()}`;
        document.getElementById("saveNotice").style.display = "block";
        document.getElementById("start").style.display = "none";
      }
    };

    function startLeague() {
      userTeam = document.getElementById("teamSelect").value;
      careerStartDate = new Date().toISOString();

      document.getElementById("start").style.display = "none";
      document.getElementById("matchContainer").style.display = "block";
      document.getElementById("playMatchBtn").disabled = false;

      fixtures = [];
      currentMatch = 0;
      table = {};
      document.getElementById("matchHistory").innerHTML = "";
      document.getElementById("nextMatch").innerText = "";

      // Reset stats for all teams
      teams.forEach(t => table[t] = { M: 0, W: 0, R: 0, P: 0, Br: 0, Diff: 0, Pts: 0 });

      // Generate fixtures - each team plays others twice (home & away)
      for (let i = 0; i < teams.length; i++) {
        for (let j = 0; j < teams.length; j++) {
          if (i !== j) fixtures.push({ home: teams[i], away: teams[j] });
        }
      }

      fixtures = shuffle(fixtures);
      updateNextMatch();
      updateTable();
      updateProgressBar();

      saveCareer(); // Zapisz start kariery
    }

    function loadCareer() {
      const savedCareer = localStorage.getItem(saveKey);
      if (!savedCareer) return alert("Brak zapisu kariery.");

      const data = JSON.parse(savedCareer);

      userTeam = data.userTeam;
      fixtures = data.fixtures;
      currentMatch = data.currentMatch;
      table = data.table;
      careerStartDate = data.careerStartDate;

      // Ustaw UI
      document.getElementById("start").style.display = "none";
      document.getElementById("matchContainer").style.display = "block";
      document.getElementById("playMatchBtn").disabled = currentMatch >= fixtures.length;

      // Odtw√≥rz historiƒô mecz√≥w
      const matchHistoryEl = document.getElementById("matchHistory");
      matchHistoryEl.innerHTML = "";
      data.matchHistory.forEach(match => {
        const li = document.createElement("li");
        li.textContent = match.text;
        if (match.isUserMatch) li.classList.add("userMatch");
        matchHistoryEl.appendChild(li);
      });
      matchHistoryEl.scrollTop = matchHistoryEl.scrollHeight;

      updateTable();
      updateProgressBar();
      updateNextMatch();

      document.getElementById("saveNotice").style.display = "none";
    }

    function resetCareer() {
      if (confirm("Czy na pewno chcesz usunƒÖƒá zapis i rozpoczƒÖƒá nowƒÖ karierƒô?")) {
        localStorage.removeItem(saveKey);
        document.getElementById("saveNotice").style.display = "none";
        document.getElementById("start").style.display = "block";
      }
    }

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function playNextMatch() {
      if (currentMatch >= fixtures.length) {
        document.getElementById("nextMatch").innerText = "Sezon zako≈Ñczony!";
        document.getElementById("playMatchBtn").disabled = true;
        return;
      }

      const match = fixtures[currentMatch];
      const isUserMatch = match.home === userTeam || match.away === userTeam;

      // Symuluj wynik meczu
      const goalsHome = Math.floor(Math.random() * 5);
      const goalsAway = Math.floor(Math.random() * 5);

      // Dodaj do historii
      const hist = document.createElement("li");
      hist.textContent = `${match.home} ${goalsHome} : ${goalsAway} ${match.away}`;
      if (isUserMatch) hist.classList.add("userMatch");
      document.getElementById("matchHistory").appendChild(hist);
      hist.scrollIntoView({ behavior: "smooth", block: "end" });

      updateTeamStats(match.home, match.away, goalsHome, goalsAway);
      updateTable();

      currentMatch++;
      updateNextMatch();
      updateProgressBar();

      saveCareer(); // Zapis po meczu
    }

    function updateNextMatch() {
      if (currentMatch >= fixtures.length) {
        document.getElementById("nextMatch").innerText = "Sezon zako≈Ñczony!";
        document.getElementById("playMatchBtn").disabled = true;
        return;
      }

      const match = fixtures[currentMatch];
      const isUserMatch = match.home === userTeam || match.away === userTeam;

      if (!isUserMatch) {
        // Automatycznie rozgrywaj mecze niezwiƒÖzane z u≈ºytkownikiem
        const goalsHome = Math.floor(Math.random() * 5);
        const goalsAway = Math.floor(Math.random() * 5);
        updateTeamStats(match.home, match.away, goalsHome, goalsAway);
        const hist = document.createElement("li");
        hist.textContent = `${match.home} ${goalsHome} : ${goalsAway} ${match.away}`;
        document.getElementById("matchHistory").appendChild(hist);
        currentMatch++;
        updateTable();
        updateNextMatch();
        saveCareer(); // Aktualizuj zapis po automatycznych meczach
      } else {
        document.getElementById("nextMatch").innerText = `${match.home} vs ${match.away}`;
        document.getElementById("playMatchBtn").disabled = false;
      }
    }

    function updateTeamStats(home, away, gh, ga) {
      table[home].M++;
      table[away].M++;
      table[home].Br += gh;
      table[away].Br += ga;
      table[home].Diff += gh - ga;
      table[away].Diff += ga - gh;

      if (gh > ga) {
        table[home].W++;
        table[away].P++;
        table[home].Pts += 3;
      } else if (gh < ga) {
        table[away].W++;
        table[home].P++;
        table[away].Pts += 3;
      } else {
        table[home].R++;
        table[away].R++;
        table[home].Pts += 1;
        table[away].Pts += 1;
      }
    }

    function updateTable() {
      const tbody = document.querySelector("#leagueTable tbody");
      tbody.innerHTML = "";
      const sorted = Object.entries(table).sort((a, b) => {
        if (b[1].Pts !== a[1].Pts) return b[1].Pts - a[1].Pts;
        if (b[1].Diff !== a[1].Diff) return b[1].Diff - a[1].Diff;
        return b[1].Br - a[1].Br;
      });

      sorted.forEach(([team, stats], index) => {
        const row = document.createElement("tr");
        if (index === 0) row.classList.add("leader");
        if (index === sorted.length - 1) row.classList.add("bottom");

        row.innerHTML = `
          <td>${team}${team === userTeam ? " ‚≠ê" : ""}</td>
          <td>${stats.M}</td>
          <td>${stats.W}</td>
          <td>${stats.R}</td>
          <td>${stats.P}</td>
          <td>${stats.Br}</td>
          <td>${stats.Diff > 0 ? "+" + stats.Diff : stats.Diff}</td>
          <td>${stats.Pts}</td>
        `;
        tbody.appendChild(row);
      });
    }

    function updateProgressBar() {
      const progress = currentMatch / fixtures.length * 100;
